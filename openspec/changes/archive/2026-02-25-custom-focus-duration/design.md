## Context

当前系统 `scripts/fetch_daily_data.py` 仅支持单日数据采集，每次运行获取一个交易日的涨停/炸板/跌停/溢价/指数数据并保存为 `data/YYYYMMDD.json`。用户需要自定义复盘周期时，只能手动编写临时脚本逐日调用并汇总。

现有资产：
- 已验证的 6 个 AKShare 接口（新浪指数、涨停池、炸板池、跌停池、昨涨停池、全A行情）
- 情绪评分模型（6 维度加权）及周期阶段映射
- `data/` 目录下的单日 JSON 缓存
- 复盘模板（每日 + 周度格式）

## Goals / Non-Goals

**Goals:**
- 用户可通过一条命令采集任意日期范围的数据，如 `python3 scripts/fetch_daily_data.py --range 20260210 20260225`
- 已采集的日期自动跳过（增量更新），避免重复网络请求
- 自动识别交易日，过滤掉周末和节假日
- 生成周期汇总报告：情绪走势、龙头演进、题材轮动、指数统计

**Non-Goals:**
- 不构建 Web UI 或图形界面，保持 CLI 脚本形态
- 不接入实时盘中数据推送，仅收盘后采集
- 不引入数据库，继续使用 JSON 文件作为存储
- 不做历史回测或策略回测引擎

## Decisions

### 1. 交易日历：使用 `exchange_calendars` vs 自建简易日历

**选择**：使用 `exchange_calendars` 库

**理由**：该库维护了上交所（XSHG）完整的交易日历，包含所有节假日和特殊休市安排，数据准确且持续更新。自建日历需要手动维护节假日列表，容易遗漏特殊假期（如国庆调休、春节）。

**替代方案考虑**：AKShare 的 `tool_trade_date_hist_sina()` 也可获取交易日列表，但返回全部历史数据（数据量大），且依赖新浪服务器稳定性。

### 2. 批量模式：扩展现有脚本 vs 新建独立脚本

**选择**：扩展现有 `fetch_daily_data.py`，新增 `--range START END` 和 `--days N` 参数

**理由**：保持单一入口，避免用户需要记忆多个脚本名。现有单日逻辑作为内部函数复用，批量模式在外层循环调用。

### 3. 增量更新策略：检查文件存在 vs 维护状态文件

**选择**：直接检查 `data/YYYYMMDD.json` 是否存在来判断是否跳过

**理由**：简单可靠，无需额外状态管理。用户如需强制刷新某日数据，可手动删除对应 JSON 文件后重新运行。

### 4. 汇总报告：生成 Markdown 文件 vs 仅控制台输出

**选择**：同时支持控制台摘要输出和 Markdown 文件生成

**理由**：控制台输出方便快速查看，Markdown 文件方便归档和后续引用。输出路径为 `data/summary_YYYYMMDD_YYYYMMDD.md`。

### 5. 指数历史数据：`stock_zh_index_daily` vs 实时接口

**选择**：批量模式使用 `stock_zh_index_daily`（历史日线接口），单日模式保留 `stock_zh_index_spot_sina`（实时接口）

**理由**：历史日线接口一次请求可获取全部日期的指数数据，比逐日调用实时接口效率更高。实时接口仅在采集当日数据时使用。

## Risks / Trade-offs

- **[AKShare 接口变动]** → AKShare 是社区维护项目，接口可能随版本升级发生变化。缓解：在脚本中封装所有 AKShare 调用为独立函数，便于快速替换。
- **[交易日历精度]** → `exchange_calendars` 对未来年份的节假日可能不完整。缓解：每年初检查并更新库版本；脚本遇到无数据的日期自动跳过而非报错。
- **[新浪全A行情接口慢]** → `stock_zh_a_spot()` 需约 40 秒完成分页请求，批量模式下若每日都调用将非常耗时。缓解：涨跌家数仅对"今日"有意义，历史日期的涨跌比从涨停/跌停数据推算近似值，不调用全A行情接口。
- **[数据覆盖风险]** → 增量模式下如果某日数据采集不完整（如网络中断），已保存的残缺 JSON 会被跳过。缓解：新增 `--force` 参数允许强制重新采集覆盖。
